## å…­ã€ç†è§£èˆ‡ç®¡ç†å‰¯ä½œç”¨ (Side Effects)

åœ¨å‡½å¼è¨­è¨ˆä¸­ï¼Œæœ€æ ¸å¿ƒä¹Ÿæœ€å®¹æ˜“è¢«å¿½ç•¥çš„æ¦‚å¿µä¹‹ä¸€å°±æ˜¯ã€Œå‰¯ä½œç”¨ã€ã€‚ç†è§£ä¸¦å¦¥å–„ç®¡ç†å‰¯ä½œç”¨ï¼Œæ˜¯å€åˆ†æ™®é€šç¨‹å¼ç¢¼èˆ‡é«˜å“è³ªã€å¯ç¶­è­·ç¨‹å¼ç¢¼çš„é—œéµã€‚

### â“ ä»€éº¼æ˜¯å‰¯ä½œç”¨ (Side Effect)ï¼Ÿ

**å‰¯ä½œç”¨**æ˜¯æŒ‡å‡½å¼åœ¨åŸ·è¡Œéç¨‹ä¸­ï¼Œé™¤äº†å›å‚³ä¸€å€‹å€¼ä¹‹å¤–ï¼Œé‚„å°**å‡½å¼å¤–éƒ¨çš„å¯è¦‹ç‹€æ…‹**ç”¢ç”Ÿäº†ä»»ä½•å½±éŸ¿ã€‚

å¸¸è¦‹çš„å‰¯ä½œç”¨åŒ…æ‹¬ï¼š
-   ä¿®æ”¹å…¨åŸŸè®Šæ•¸æˆ–éœæ…‹è®Šæ•¸ã€‚
-   ä¿®æ”¹å‚³å…¥çš„åƒæ•¸ï¼ˆå¦‚ç‰©ä»¶æˆ–é™£åˆ—ï¼‰ã€‚
-   åŸ·è¡Œä»»ä½• I/O æ“ä½œï¼Œä¾‹å¦‚ï¼š
    -   å¯«å…¥æª”æ¡ˆæˆ–è³‡æ–™åº«ã€‚
    -   å‘¼å«å¤–éƒ¨ APIã€‚
    -   åœ¨æ§åˆ¶å°ï¼ˆConsoleï¼‰ä¸Šå°å‡ºæ—¥èªŒã€‚
-   è§¸ç™¼ä¸€å€‹äº‹ä»¶æˆ–è¨Šæ¯ã€‚

### âœ¨ ä»€éº¼æ˜¯ç´”å‡½å¼ (Pure Function)ï¼Ÿ

èˆ‡å‰¯ä½œç”¨ç›¸å°çš„æ¦‚å¿µæ˜¯ã€Œç´”å‡½å¼ã€ã€‚ä¸€å€‹å‡½å¼å¦‚æœæ»¿è¶³ä»¥ä¸‹å…©å€‹æ¢ä»¶ï¼Œå°±æ˜¯ç´”å‡½å¼ï¼š
1.  **ç›¸åŒçš„è¼¸å…¥æ°¸é å¾—åˆ°ç›¸åŒçš„è¼¸å‡º**ï¼šå‡½å¼çš„å›å‚³å€¼åªä¾è³´æ–¼å…¶è¼¸å…¥åƒæ•¸ï¼Œä¸å—ä»»ä½•å¤–éƒ¨ç‹€æ…‹å½±éŸ¿ã€‚
2.  **æ²’æœ‰å¯è§€å¯Ÿçš„å‰¯ä½œç”¨**ï¼šå‡½å¼ä¸æœƒä¿®æ”¹ä»»ä½•å¤–éƒ¨ç‹€æ…‹ã€‚

ç´”å‡½å¼å°±åƒä¸€å€‹å¯é çš„æ•¸å­¸å…¬å¼ï¼Œä¾‹å¦‚ `sum(2, 3)` æ°¸é æœƒå›å‚³ `5`ï¼Œç„¡è«–ä½ å‘¼å«å®ƒå¤šå°‘æ¬¡ï¼Œä¹Ÿä¸æœƒå½±éŸ¿åˆ°ç³»çµ±çš„å…¶ä»–éƒ¨åˆ†ã€‚

### ğŸ’” ç‚ºä»€éº¼å‰¯ä½œç”¨æ˜¯å€‹å•é¡Œï¼Ÿ

-   **ä¸å¯é æ¸¬æ€§**ï¼šæœ‰å‰¯ä½œç”¨çš„å‡½å¼å¾ˆé›£é æ¸¬å…¶è¡Œç‚ºã€‚`calculateTotal()` å¯èƒ½é€™æ¬¡å›å‚³ `100`ï¼Œä¸‹æ¬¡å› ç‚ºæŸå€‹å…¨åŸŸæŠ˜æ‰£è®Šæ•¸è¢«ä¿®æ”¹è€Œå›å‚³ `80`ã€‚
-   **é›£ä»¥æ¸¬è©¦**ï¼šæ¸¬è©¦æœ‰å‰¯ä½œç”¨çš„å‡½å¼å¾ˆéº»ç…©ã€‚ä½ éœ€è¦æ¨¡æ“¬ï¼ˆMockï¼‰è³‡æ–™åº«ã€APIï¼Œä¸¦é©—è­‰å¤–éƒ¨ç‹€æ…‹æ˜¯å¦è¢«æ­£ç¢ºä¿®æ”¹ã€‚è€Œæ¸¬è©¦ç´”å‡½å¼åªéœ€è¦çµ¦å®šè¼¸å…¥ä¸¦æ–·è¨€è¼¸å‡ºå³å¯ã€‚
-   **é™ä½å¯è®€æ€§èˆ‡å¯ç¶­è­·æ€§**ï¼šç•¶ä½ çœ‹åˆ°ä¸€å€‹å‡½å¼å‘¼å«æ™‚ï¼Œå¦‚æœå®ƒæ˜¯ç´”å‡½å¼ï¼Œä½ åªéœ€è¦é—œå¿ƒå®ƒçš„å›å‚³å€¼ã€‚å¦‚æœå®ƒæœ‰å‰¯ä½œç”¨ï¼Œä½ é‚„å¿…é ˆè¿½è¹¤å®ƒå¯èƒ½å°ç³»çµ±ç”¢ç”Ÿçš„æ‰€æœ‰æ½›åœ¨å½±éŸ¿ã€‚
-   **ä½µç™¼å•é¡Œ**ï¼šåœ¨å¤šåŸ·è¡Œç·’ç’°å¢ƒä¸‹ï¼Œå¦‚æœå¤šå€‹åŸ·è¡Œç·’åŒæ™‚å‘¼å«ä¸€å€‹æœƒä¿®æ”¹å…±äº«ç‹€æ…‹çš„å‡½å¼ï¼Œå°±æœƒç”¢ç”Ÿç«¶çˆ­æ¢ä»¶ (Race Condition)ï¼Œå°è‡´ä¸å¯é æœŸçš„éŒ¯èª¤ã€‚

### ğŸ› ï¸ å¦‚ä½•ç®¡ç†å‰¯ä½œç”¨ï¼Ÿ

å‰¯ä½œç”¨æ˜¯ä¸å¯é¿å…çš„ï¼Œä¾‹å¦‚æˆ‘å€‘ç¸½éœ€è¦å°‡è³‡æ–™å­˜å…¥è³‡æ–™åº«ã€‚é—œéµä¸æ˜¯å®Œå…¨æ¶ˆæ»…å‰¯ä½œç”¨ï¼Œè€Œæ˜¯**å°‡å®ƒå€‘èˆ‡æ ¸å¿ƒæ¥­å‹™é‚è¼¯åˆ†é›¢**ã€‚

**ç­–ç•¥ï¼šå°‡ç´”é‚è¼¯èˆ‡ä¸ç´”çš„è¡Œç‚ºåˆ†é›¢**

è®“å¤§éƒ¨åˆ†çš„ç¨‹å¼ç¢¼ï¼ˆç‰¹åˆ¥æ˜¯è¤‡é›œçš„æ¥­å‹™é‚è¼¯ï¼‰ä¿æŒç´”ç²¹ï¼Œä¸¦å°‡å‰¯ä½œç”¨æ¨å‘ç³»çµ±çš„é‚Šç·£ï¼ˆä¾‹å¦‚ Controllerã€ä¸»ç¨‹å¼é€²å…¥é»ï¼‰ã€‚

#### ç¯„ä¾‹ï¼šè¨ˆç®—è³¼ç‰©è»Šç¸½åƒ¹

-   âŒ **ä¸å¥½çš„å¯«æ³• (å‰¯ä½œç”¨èˆ‡é‚è¼¯æ··åˆ)**
    ```typescript
    // å…¨åŸŸè®Šæ•¸ï¼Œå¯èƒ½åœ¨ä»»ä½•åœ°æ–¹è¢«ä¿®æ”¹
    let taxRate = 0.05; 

    // é€™å€‹å‡½å¼æœ‰å‰¯ä½œç”¨ï¼šè®€å–äº†å…¨åŸŸè®Šæ•¸ taxRate
    function calculateTotal(items: { price: number }[]): number {
      const subtotal = items.reduce((sum, item) => sum + item.price, 0);
      const tax = subtotal * taxRate; // ä¾è³´å¤–éƒ¨ç‹€æ…‹
      return subtotal + tax;
    }
    ```

-   âœ… **å¥½çš„å¯«æ³• (åˆ†é›¢å‰¯ä½œç”¨)**
    ```typescript
    // 1. ç´”å‡½å¼ï¼šæ ¸å¿ƒè¨ˆç®—é‚è¼¯
    // ä¸å†ä¾è³´ä»»ä½•å¤–éƒ¨ç‹€æ…‹ï¼Œæ‰€æœ‰éœ€è¦çš„è³‡è¨Šéƒ½é€éåƒæ•¸å‚³å…¥
    function calculateTotal(items: { price: number }[], taxRate: number): number {
      const subtotal = items.reduce((sum, item) => sum + item.price, 0);
      const tax = subtotal * taxRate;
      return subtotal + tax;
    }

    // 2. ä¸ç´”çš„ç¨‹å¼ç¢¼ (ç³»çµ±é‚Šç·£)
    // è² è²¬ç²å–å¤–éƒ¨ç‹€æ…‹ï¼Œä¸¦å‘¼å«ç´”å‡½å¼
    function main() {
      const items = [{ price: 100 }, { price: 200 }];
      const currentTaxRate = database.getTaxRate(); // å‰¯ä½œç”¨ï¼šè®€å–è³‡æ–™åº«
      
      // å‘¼å«ç´”å‡½å¼ä¾†åŸ·è¡Œæ ¸å¿ƒé‚è¼¯
      const total = calculateTotal(items, currentTaxRate);
      
      console.log(total); // å‰¯ä½œç”¨ï¼šå¯«å…¥æ§åˆ¶å°
    }
    ```

#### C# ç¯„ä¾‹
```csharp
// âŒ ä¸ç´”çš„å‡½å¼
public class ImpureCalculator
{
    public static double TaxRate = 0.2; // éœæ…‹è®Šæ•¸ (å¤–éƒ¨ç‹€æ…‹)

    public double Calculate(double price)
    {
        return price * (1 + TaxRate); // ä¾è³´å¤–éƒ¨ç‹€æ…‹
    }
}

// âœ… ç´”å‡½å¼
public class PureCalculator
{
    // æ‰€æœ‰ä¾è³´éƒ½é€éåƒæ•¸å‚³å…¥
    public double Calculate(double price, double taxRate)
    {
        return price * (1 + taxRate);
    }
}
```

#### Python ç¯„ä¾‹
```python
# âŒ ä¸ç´”çš„å‡½å¼
user_list = [] # å…¨åŸŸè®Šæ•¸

def add_user(name):
    # å‰¯ä½œç”¨ï¼šä¿®æ”¹äº†å…¨åŸŸè®Šæ•¸
    user_list.append({"name": name})

# âœ… ç´”å‡½å¼
def add_user_pure(users, name):
    # å›å‚³ä¸€å€‹æ–°çš„ listï¼Œä¸ä¿®æ”¹åŸå§‹çš„ users
    return users + [{"name": name}]

# --- ä½¿ç”¨ ---
initial_users = []
new_users = add_user_pure(initial_users, "Alice")
# initial_users ä»ç„¶æ˜¯ []
# new_users æ˜¯ [{"name": "Alice"}]
```

---

[â† å›ç›®éŒ„](./00-README.md) | [ä¸‹ä¸€ç« ï¼šé¡åˆ¥èˆ‡ç‰©ä»¶ â†’](./07-Classes.md)
